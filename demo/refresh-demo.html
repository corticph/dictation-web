<!--
DO NOT USE THIS APPROACH IN PRODUCTION.
NEVER EXPOSE CLIENT SECRET IN THE FRONTEND.
THIS IS ONLY FOR DEMONSTRATION PURPOSES.
-->

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>Automatic Token Refresh Demo</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.classless.min.css"
    />
  </head>
  <body>
    <header>
      <nav><a href="index.html">‚Üê Back to Demo Index</a></nav>
      <h1>Automatic Token Refresh Demo</h1>
      <p>This demo demonstrates how to automatically refresh the access token when it is near expiration.</p>
    </header>
    <main>
      <article id="componentPlaceholder">
        <corti-dictation></corti-dictation>
      </article>

      <textarea
        id="transcript"
        placeholder="Transcript will appear here..."
      ></textarea>
    </main>

    <script type="module">
      // Import the Corti Dictation SDK
      // import "@corti/dictation-web";
      import "../dist/bundle.js";

      const dictation = document.querySelector("corti-dictation");
      const componentPlaceholder = document.getElementById("componentPlaceholder");
      const transcriptArea = document.getElementById("transcript");

      dictation.setAuthConfig({
        accessToken: "INITIAL_ACCESS_TOKEN",
        refreshToken: "INITIAL_REFRESH_TOKEN",
        refreshAccessToken: async (refreshToken) => {
          const response = await fetch("https://your-auth-server/token", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ refreshToken: refreshToken }),
          });

          return response.json();
        },
      });

      // Update the textarea with transcript text when received
      dictation.addEventListener("transcript", (e) => {
        const { data } = e.detail;
        if (data.isFinal) {
          transcriptArea.value += data.text + " ";
        }
      });
    </script>
  </body>
</html>
